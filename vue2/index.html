<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="index.css"/>
</head>
<body>
	 <section class="todoapp">
        <div>
            <header class="header" >
                <h1>todos</h1>
                <input class="new-todo" placeholder="请输入内容" v-model="val" @keyup.13="keyup"/>
            </header>
            <section class="main">
                <input class="toggle-all" type="checkbox" v-model="all" @click="changeall" :checked="computALL">
                <ul class="todo-list">
                    <li :class="{completed:val.checked,editing:val.etding}" v-for="(val,key) in listclick">
                        <div class="view">
                            <input class="toggle" type="checkbox" v-model="val.checked" >
                            <label @dblclick="dbclick(val,$event)">{{val.text}}</label>
                            <button class="destroy" v-model="" @click="remove(val)"></button>
                        </div>
                        <input class="edit"  :value="val.text" @blur="blur(val,$event)" @keyup.esc="esc(val)" @keyup.13="blur(val,$event)"/>
                    </li>
                </ul>
            </section>
        </div>
        <footer class="footer" v-show="arr.length">
	            <span class="todo-count">
	            	<strong>{{Num}}</strong>
	            	<span>条未选中</span>
	            </span>
	            <ul class="filters">
	            	<li v-for="(val,key) in list"><a :href ="val.hash"  @click="hash=val.hash" :class="{selected:hash==val.hash}">{{val.name}}</a></li>
	            </ul>
	            <button class="clear-completed"  @click="clearcompleted">清除完成项</button>
        </footer>
    </section>
	<script src="vue.js"></script>
	<script type="text/javascript">
	 new Vue({
			el:'.todoapp',
			 data: {
			    arr:[
			    	{text:'小红',checked:false,id:0,etding:false},
			    	{text:'小黄',checked:false,id:1,etding:false}
			    ],
			    list:[
			        {name:'全部',checked:true,hash:'#/all'},
			        {name:'未完成',checked:false,hash:'#/active'},
			        {name:'已完成',checked:false,hash:'#/completed'}
			    ],
			    val:'',
			    all:false,
			    hash:"#/all"
			 },

			 computed:{
			 	computALL:function(){
			 		if(this.arr.length){
			 			return this.all= this.arr.every(e=>e.checked);
			 		}else{
			 			this.all=false;
			 		}
			 		
			 	},
			 	Num:function(){
			 		let obj2=Object.assign(this.arr);
			 		return this.arr.filter(e=>{
			 			return !e.checked;
			 		}).length;
			 	},
			 	listclick(){
			 		let data2=Object.assign(this.arr);
			 		return data2.filter(e=>{
			 			
					      	switch(this.hash){

					      		case '#/all':
					      			return Object.assign(this.arr);
					      		break;
					        	case '#/active':
					          		return !e.checked;
					          	break;
					       	 	case '#/completed':
					       	   		return e.checked;
					          	break;
					        }

			 		})

			 	}
			 },
			 methods:{
			 	keyup(){
			 		this.arr.push({
			 			text:this.val,
			 			checked:false,
			 			id:+new Date,
			 			etding:false
			 		})
			 		this.val="";
			 	},
			 	changeall(){
			 		this.arr.forEach(e=>e.checked=this.all);
			 	},
			 	remove(val){
			 		this.arr=this.arr.filter((e)=>{
			 			return e.id!=val.id
			 		})
			 	},
			 	dbclick(val,ev){
			 		this.arr.filter(e=>{
			 			if(e.id==val.id){
			 				e.etding=true;
			 			}
			 		})
			 		Vue.nextTick(function(){
			 			ev.target.focus();
			 		})
			 		
			 	},
			 	blur(val,ev){
			 		this.arr.forEach(e=>{
			 			if(e.id == val.id){
			 				e.etding=false;
			 				e.text=ev.target.value;
			 			}
			 		})
			 	},
			 	esc(val,ev){
			 		this.blur(val,ev);
			 		ev.target.value=val.text;
			 	},
			 	clearcompleted(){
			 		this.arr=this.arr.filter(e=>{
			 			return !e.checked;
			 		})
			 	}
			 }
		})
	</script>
</body>
</html>